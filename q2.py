import numpy as np
import lin_systems as ls
import index_calculus as idx
import utils

from random import shuffle

def main ():
    p = 29115944009

    input = """14034769290;2;1;5;3;13;1;29;1;31;1;71;1;83;1;
    25737054364;2;1;3;1;7;1;11;1;17;1;103;2;127;1;
    21868125640;2;3;17;3;31;1;37;1;47;1;
    30985550769;2;6;23;1;31;1;37;1;53;1;67;1;
    28085743678;5;1;11;2;19;1;101;1;103;1;127;1;
    29843719046;2;5;5;1;7;1;19;1;23;1;53;1;157;1;
    9468203386;2;3;3;4;7;1;11;2;37;1;53;1;
    3689242454;2;3;37;2;79;1;131;1;137;1;
    13087217154;3;1;7;5;29;1;79;1;109;1;
    31871438204;2;1;3;1;23;1;29;3;53;1;59;1;
    1340596845;2;2;3;8;5;1;7;1;11;1;17;1;97;1;
    31560070070;3;2;11;2;17;1;41;1;73;1;101;1;
    18485663532;2;2;5;4;7;3;13;2;89;1;
    20019986634;2;4;5;1;7;1;17;2;103;1;
    30209466942;2;1;3;1;7;1;19;1;59;1;61;1;163;1;
    12857614811;2;2;3;1;13;1;37;2;53;1;157;1;
    10638960517;2;1;3;1;17;3;23;1;29;1;41;1;
    6713152038;3;2;5;1;61;2;137;1;163;1;
    28207047258;2;4;5;1;11;1;53;1;71;1;79;1;89;1;
    4968981082;2;5;5;1;11;1;13;1;47;1;61;1;173;1;
    25261255734;5;1;53;2;83;1;163;1;
    15088613342;2;2;5;1;13;1;43;2;67;1;167;1;
    5418663041;23;1;67;2;89;1;167;1;
    11020670101;11;1;19;1;59;2;67;1;157;1;
    17467890943;7;3;53;1;61;1;67;1;73;1;
    1749227270;2;2;3;2;5;2;19;1;43;1;61;1;151;1;
    14988453221;2;2;3;1;5;3;11;1;59;1;67;1;127;1;
    4878061651;2;1;3;1;41;1;61;1;79;1;83;1;157;1;
    30140447554;2;7;19;1;31;2;37;1;157;1;
    30970435160;7;2;11;1;19;1;89;1;101;1;107;1;
    6594699843;5;1;43;1;59;1;71;1;127;1;131;1;
    19575126077;19;2;37;1;59;1;167;1;
    19607543987;2;3;13;1;19;1;29;1;43;1;61;1;97;1;
    19275175728;2;4;107;2;149;1;173;1;
    32790630872;2;2;13;1;41;1;47;1;83;1;131;1;
    19492415161;2;5;3;1;13;2;47;1;53;1;139;1;
    3687533826;3;1;11;1;23;2;79;1;109;1;137;1;
    14264046236;3;3;7;1;31;2;149;1;167;1;
    9671481053;3;1;37;1;53;1;127;1;139;1;157;1;
    6891848049;2;4;3;1;7;1;13;2;37;1;47;1;103;1;
    10553721005;2;1;5;1;19;1;31;1;53;1;59;1;131;1;
    27508108973;3;3;7;6;13;1;17;1;23;1;
    25658795224;2;5;3;5;13;1;31;1;61;1;151;1;
    6317179985;2;2;5;1;11;1;23;1;41;1;
    29661481672;2;9;11;2;23;1;43;1;107;1;
    5348648322;2;3;3;1;7;1;13;2;19;2;173;1;
    8845087553;3;3;5;1;7;1;19;2;83;1;103;1;
    3557876599;2;1;3;1;31;1;37;1;47;1;101;1;149;1;
    8177732343;3;1;5;3;41;1;71;2;139;1;
    32150826228;2;2;5;4;11;1;19;1;37;1;101;1;
    30023052550;2;2;19;1;53;1;61;1;151;1;
    31026314607;3;3;31;1;37;1;41;1;67;1;151;1;
    7529256646;3;1;5;3;41;1;79;1;83;1;157;1;
    4657032290;7;1;53;1;79;1;109;1;
    664264948;3;1;11;1;19;1;103;1;139;1;151;1;
    5587630096;11;1;23;1;71;1;89;1;163;1;
    29973757052;23;1;79;1;127;2;137;1;
    758591970;5;2;11;1;43;1;53;1;79;1;149;1;
    18147662738;2;1;7;2;67;1;103;1;109;1;163;1;
    3915084083;2;1;29;1;53;1;131;1;137;1;151;1;
    22514432406;2;1;3;1;7;1;11;2;61;1;89;1;173;1;
    535110272;2;3;5;3;11;3;13;1;17;1;67;1;
    18197202031;3;2;7;2;11;1;41;1;97;1;113;1;"""

    factor_base = idx.get_factor_base(40)
    

    equations = []
    for line in input.split("\n"):
        eqn_str = line.split(";")[:-1]
        
        equation = [0 for _ in factor_base]
        equation.append(int(eqn_str[0]))
        
        i = 1
        while i < len(eqn_str):
            prime = int(eqn_str[i])
            a = int(eqn_str[i + 1])
            
            p_ind = factor_base.index(prime)
            equation[p_ind] = a
            
            i += 2
        
        equations.append(equation)
        
    linsys = np.array(equations)
    logs = ls.ge_mod_n(linsys, p - 1)
    log_map = dict(zip(factor_base, logs))
    for n in [23, 29, 31, 37]:
        print(n, log_map[n])

if __name__ == '__main__':
    main()